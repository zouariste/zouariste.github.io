<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Analyze your Facebook and Instagram data - Extract followers, following lists, and find unfollowers">
    <meta name="author" content="Mohamed Zouari">
    <meta name="keywords" content="meta extractor, facebook, instagram, followers, unfollowers, social media analytics">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="Meta Extractor - Social Media Analyzer">
    <meta property="og:description" content="Analyze your Facebook and Instagram connections">

    <title>Meta Extractor - Facebook & Instagram Analyzer</title>
    
    <!-- JSZip Library for creating ZIP files -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .card {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            margin-bottom: 20px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 12px 24px;
            border: none;
            background: #f0f0f0;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s;
        }

        .tab-btn:hover {
            background: #e0e0e0;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .platform-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-left: 8px;
        }

        .platform-badge.facebook {
            background: #1877f2;
            color: white;
        }

        .platform-badge.instagram {
            background: linear-gradient(45deg, #f09433 0%,#e6683c 25%,#dc2743 50%,#cc2366 75%,#bc1888 100%);
            color: white;
        }

        textarea {
            width: 100%;
            min-height: 200px;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            resize: vertical;
            margin-bottom: 15px;
        }

        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: transform 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: #6c757d;
            margin-left: 10px;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .results {
            margin-top: 30px;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .results-header h2 {
            color: #333;
        }

        .count-badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .profile-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
            position: relative;
        }

        .profile-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
        }

        .profile-card img {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 15px;
            border: 3px solid white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .profile-card .name {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
            word-wrap: break-word;
        }

        .profile-card .link {
            color: #667eea;
            text-decoration: none;
            font-size: 0.9rem;
        }

        .profile-card .link:hover {
            text-decoration: underline;
        }

        .no-results {
            text-align: center;
            padding: 40px;
            color: #666;
            font-size: 1.1rem;
        }

        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #2196F3;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }

        .info-box h3 {
            color: #1976D2;
            margin-bottom: 8px;
        }

        .info-box ol {
            margin-left: 20px;
            color: #333;
        }

        .info-box li {
            margin: 5px 0;
        }

        .comparison-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .navigation-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .nav-link {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            text-decoration: none;
            color: white;
            font-weight: 500;
            transition: all 0.3s ease;
            display: inline-block;
            backdrop-filter: blur(10px);
        }

        .nav-link:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .loading {
            display: inline-block;
            margin-left: 10px;
            color: #667eea;
            font-weight: 500;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #f0f0f0;
            border-radius: 15px;
            overflow: hidden;
            margin: 15px 0;
            display: none;
        }

        .progress-bar.active {
            display: block;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .comparison-inputs {
                grid-template-columns: 1fr;
            }

            header h1 {
                font-size: 1.8rem;
            }

            .grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <nav class="navigation-header" aria-label="Main navigation">
            <a href="../../index.html" class="nav-link" aria-label="Return to homepage">← Home</a>
            <a href="../index.html" class="nav-link" aria-label="Return to tools">← Back to Tools</a>
        </nav>
        <header role="banner">
            <h1>Meta Extractor</h1>
            <p>Analyze your Facebook & Instagram connections</p>
        </header>

        <main role="main">
        <div class="card">
            <div class="tabs">
                <button class="tab-btn active" onclick="switchTab('fb-blocks')">
                    Blocked Users <span class="platform-badge facebook">Facebook</span>
                </button>
                <button class="tab-btn" onclick="switchTab('ig-followers')">
                    Followers <span class="platform-badge instagram">Instagram</span>
                </button>
                <button class="tab-btn" onclick="switchTab('ig-following')">
                    Following <span class="platform-badge instagram">Instagram</span>
                </button>
                <button class="tab-btn" onclick="switchTab('ig-unfollowers')">
                    Find Unfollowers <span class="platform-badge instagram">Instagram</span>
                </button>
            </div>

            <!-- Facebook Blocks Tab -->
            <div id="fb-blocks" class="tab-content active">
                <div class="info-box">
                    <h3>Facebook Blocked Users - How to use:</h3>
                    <ol>
                        <li>Download your Facebook data (Settings → Privacy → Download Your Information)</li>
                        <li>Select "Blocked Users" and download as HTML</li>
                        <li>Open the HTML file and copy all content</li>
                        <li>Paste it below and click "Extract Data"</li>
                    </ol>
                </div>
                <textarea id="fbBlocksInput" placeholder="Paste your Facebook blocked users HTML here..."></textarea>
                <button class="btn" onclick="extractFacebookBlocks()">Extract Data</button>
                <button class="btn btn-secondary" onclick="clearResults('fb-blocks')">Clear</button>
                <span id="loadingIndicatorFB" class="loading" style="display: none;">Processing images...</span>
                <div class="progress-bar" id="progressBarFB">
                    <div class="progress-fill" id="progressFillFB">0%</div>
                </div>
                <div id="fbBlocksResults" class="results"></div>
            </div>

            <!-- Instagram Followers Tab -->
            <div id="ig-followers" class="tab-content">
                <div class="info-box">
                    <h3>Instagram Followers - How to use:</h3>
                    <ol>
                        <li>Download your Instagram data (Settings → Security → Download Data)</li>
                        <li>Extract and open the followers HTML file</li>
                        <li>Copy all content and paste below</li>
                        <li>Click "Extract Data"</li>
                    </ol>
                </div>
                <textarea id="igFollowersInput" placeholder="Paste your Instagram followers HTML here..."></textarea>
                <button class="btn" onclick="extractInstagramFollowers()">Extract Data</button>
                <button class="btn btn-secondary" onclick="clearResults('ig-followers')">Clear</button>
                <span id="loadingIndicatorFollowers" class="loading" style="display: none;">Processing images...</span>
                <div class="progress-bar" id="progressBarFollowers">
                    <div class="progress-fill" id="progressFillFollowers">0%</div>
                </div>
                <div id="igFollowersResults" class="results"></div>
            </div>

            <!-- Instagram Following Tab -->
            <div id="ig-following" class="tab-content">
                <div class="info-box">
                    <h3>Instagram Following - How to use:</h3>
                    <ol>
                        <li>Download your Instagram data</li>
                        <li>Open the following/followings HTML file</li>
                        <li>Copy all content and paste below</li>
                        <li>Click "Extract Data"</li>
                    </ol>
                </div>
                <textarea id="igFollowingInput" placeholder="Paste your Instagram following HTML here..."></textarea>
                <button class="btn" onclick="extractInstagramFollowing()">Extract Data</button>
                <button class="btn btn-secondary" onclick="clearResults('ig-following')">Clear</button>
                <span id="loadingIndicatorFollowing" class="loading" style="display: none;">Processing images...</span>
                <div class="progress-bar" id="progressBarFollowing">
                    <div class="progress-fill" id="progressFillFollowing">0%</div>
                </div>
                <div id="igFollowingResults" class="results"></div>
            </div>

            <!-- Instagram Unfollowers Tab -->
            <div id="ig-unfollowers" class="tab-content">
                <div class="info-box">
                    <h3>Find Instagram Unfollowers - How to use:</h3>
                    <ol>
                        <li>Paste your Following HTML in the left box</li>
                        <li>Paste your Followers HTML in the right box</li>
                        <li>Click "Find Unfollowers" to see who doesn't follow you back</li>
                    </ol>
                </div>
                <div class="comparison-inputs">
                    <div>
                        <h3 style="margin-bottom: 10px;">Following</h3>
                        <textarea id="unfollowersFollowingInput" placeholder="Paste your Following HTML here..."></textarea>
                    </div>
                    <div>
                        <h3 style="margin-bottom: 10px;">Followers</h3>
                        <textarea id="unfollowersFollowersInput" placeholder="Paste your Followers HTML here..."></textarea>
                    </div>
                </div>
                <button class="btn" onclick="findInstagramUnfollowers()">Find Unfollowers</button>
                <button class="btn btn-secondary" onclick="clearResults('ig-unfollowers')">Clear</button>
                <span id="loadingIndicatorUnfollowers" class="loading" style="display: none;">Processing images...</span>
                <div class="progress-bar" id="progressBarUnfollowers">
                    <div class="progress-fill" id="progressFillUnfollowers">0%</div>
                </div>
                <div id="igUnfollowersResults" class="results"></div>
            </div>
        </div>
        </main>
    </div>

    <script>
        // Store extracted data
        let extractedData = {
            fbBlocks: [],
            igFollowers: [],
            igFollowing: [],
            igUnfollowers: []
        };

        // Switch between tabs
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // Update progress bar
        function updateProgress(progressBarId, percent, text = null) {
            const progressBar = document.getElementById(progressBarId);
            const progressFill = progressBar.querySelector('.progress-fill');
            progressBar.classList.add('active');
            progressFill.style.width = percent + '%';
            progressFill.textContent = text || `${Math.round(percent)}%`;
        }

        // Hide progress bar
        function hideProgress(progressBarId) {
            const progressBar = document.getElementById(progressBarId);
            progressBar.classList.remove('active');
            const progressFill = progressBar.querySelector('.progress-fill');
            progressFill.style.width = '0%';
        }

        // Convert image URL to base64 with CORS proxy support
        async function imageUrlToBase64(url, proxyAttempt = 0) {
            const proxies = [
                '',  // Direct
                'https://corsproxy.io/?',
                'https://api.allorigins.win/raw?url='
            ];

            try {
                const proxy = proxies[proxyAttempt] || '';
                const fetchUrl = proxy ? `${proxy}${encodeURIComponent(url)}` : url;
                
                const response = await fetch(fetchUrl, {
                    mode: 'cors',
                    credentials: 'omit'
                });
                
                if (!response.ok) {
                    if (proxyAttempt < proxies.length - 1) {
                        return await imageUrlToBase64(url, proxyAttempt + 1);
                    }
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const blob = await response.blob();
                
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onloadend = () => resolve(reader.result);
                    reader.onerror = reject;
                    reader.readAsDataURL(blob);
                });
            } catch (error) {
                if (proxyAttempt < proxies.length - 1) {
                    return await imageUrlToBase64(url, proxyAttempt + 1);
                }
                console.error('Error converting image:', error);
                return null;
            }
        }

        // Parse Facebook blocked users
        async function parseFacebookBlocks(html, progressBarId) {
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            const profiles = [];

            const userContainers = doc.querySelectorAll('.x1obq294');
            console.log(`Found ${userContainers.length} user containers`);

            let processed = 0;
            const total = userContainers.length;

            for (const container of userContainers) {
                const nameSpan = container.querySelector('span[id^="_r"]');
                if (!nameSpan) {
                    processed++;
                    continue;
                }
                const name = nameSpan.textContent.trim();
                if (!name || name.length === 0) {
                    processed++;
                    continue;
                }

                let imgUrl = '';
                
                const svgImage = container.querySelector('image[*|href]');
                if (svgImage) {
                    imgUrl = svgImage.getAttributeNS('http://www.w3.org/1999/xlink', 'href') || 
                             svgImage.getAttribute('xlink:href') ||
                             svgImage.getAttribute('href');
                }

                if (!imgUrl) {
                    const allSvgImages = container.querySelectorAll('svg image');
                    for (const img of allSvgImages) {
                        const href = img.getAttributeNS('http://www.w3.org/1999/xlink', 'href') || 
                                    img.getAttribute('xlink:href') ||
                                    img.getAttribute('href');
                        if (href && href.startsWith('http')) {
                            imgUrl = href;
                            break;
                        }
                    }
                }

                if (!imgUrl) {
                    const imgTag = container.querySelector('img');
                    if (imgTag) {
                        imgUrl = imgTag.src || imgTag.getAttribute('src');
                    }
                }

                let finalImageUrl = `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&size=150&background=667eea&color=fff`;
                
                if (imgUrl && (imgUrl.startsWith('http://') || imgUrl.startsWith('https://'))) {
                    const base64Image = await imageUrlToBase64(imgUrl);
                    if (base64Image) {
                        finalImageUrl = base64Image;
                    }
                }

                let profileLink = '#';
                const linkTag = container.querySelector('a[href]');
                if (linkTag) {
                    const href = linkTag.getAttribute('href');
                    if (href && href.includes('facebook.com')) {
                        profileLink = href;
                    }
                }

                profiles.push({
                    name: name,
                    imgUrl: finalImageUrl,
                    profileLink: profileLink
                });

                processed++;
                const percent = (processed / total) * 100;
                updateProgress(progressBarId, percent, `${processed}/${total}`);
            }

            return profiles;
        }

        // Parse Instagram profiles with image download
        async function parseInstagramProfiles(html, progressBarId) {
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');

            const profiles = [];
            const seenUsernames = new Set();

            const allDivs = doc.querySelectorAll('div');
            const totalDivs = allDivs.length;
            let processed = 0;

            for (const div of allDivs) {
                const link = div.querySelector('a[href^="/"]');
                if (!link) {
                    processed++;
                    continue;
                }

                const href = link.getAttribute('href') || '';
                const match = href.match(/^\/([A-Za-z0-9._]+)(?:\/|$)/);
                if (!match) {
                    processed++;
                    continue;
                }

                const usernameSlug = match[1];
                const usernameKey = usernameSlug.toLowerCase();
                
                if (seenUsernames.has(usernameKey)) {
                    processed++;
                    continue;
                }
                seenUsernames.add(usernameKey);

                // Get display name
                let displayName = usernameSlug;
                const spanTexts = Array.from(div.querySelectorAll('span'))
                    .map(el => (el.textContent || '').trim())
                    .filter(t => t && t.toLowerCase() !== usernameKey && !/^(follow|following)$/i.test(t));

                if (spanTexts.length > 0) {
                    displayName = spanTexts.find(t => /\s/.test(t)) || spanTexts[0] || usernameSlug;
                }

                // Extract image
                let imgUrl = '';
                let img = div.querySelector(`img[alt="${usernameSlug}'s profile picture"]`);
                if (img) {
                    imgUrl = img.getAttribute('src') || img.src || '';
                }

                if (!imgUrl) {
                    img = div.querySelector('img');
                    if (img) {
                        imgUrl = img.getAttribute('src') || img.src || '';
                    }
                }

                if (!imgUrl) {
                    const parentDiv = div.closest('.html-div') || div.parentElement;
                    if (parentDiv) {
                        img = parentDiv.querySelector('img');
                        if (img) {
                            imgUrl = img.getAttribute('src') || img.src || '';
                        }
                    }
                }

                // Convert to base64
                let finalImageUrl = `https://ui-avatars.com/api/?name=${encodeURIComponent(displayName)}&size=150&background=e4405f&color=fff`;
                
                if (imgUrl && (imgUrl.startsWith('http://') || imgUrl.startsWith('https://'))) {
                    const base64Image = await imageUrlToBase64(imgUrl);
                    if (base64Image) {
                        finalImageUrl = base64Image;
                    }
                } else if (imgUrl && imgUrl.startsWith('data:image')) {
                    finalImageUrl = imgUrl;
                }

                const profileLink = href.startsWith('http') ? href : `https://www.instagram.com${href}`;

                profiles.push({
                    name: displayName,
                    imgUrl: finalImageUrl,
                    profileLink: profileLink
                });

                processed++;
                if (processed % 10 === 0 || processed === totalDivs) {
                    const percent = (profiles.length / seenUsernames.size) * 100;
                    updateProgress(progressBarId, Math.min(percent, 100), `${profiles.length} profiles`);
                }
            }

            return profiles;
        }

        // Display profiles in a grid
        async function displayProfiles(profiles, containerId, title) {
          const container = document.getElementById(containerId);

          if (!profiles || profiles.length === 0) {
            container.innerHTML = '<div class="no-results">No profiles found. Please check your HTML format.</div>';
            return;
          }

          let html = `
            <div class="results-header">
              <h2>${title}</h2>
              <span class="count-badge">${profiles.length} ${profiles.length === 1 ? 'person' : 'people'}</span>
            </div>
            <div style="margin-bottom: 15px;">
              <button class="btn" onclick="downloadAsZip('${containerId}', '${title}')">Download as ZIP with Images</button>
            </div>
            <div class="grid" id="grid-${containerId}">
          `;

          profiles.forEach(profile => {
            const escapedName = profile.name.replace(/'/g, "\\'").replace(/"/g, '&quot;');
            const profileLink = profile.profileLink || '#';
            html += `
              <div class="profile-card" onclick="window.open('${profileLink}', '_blank')">
                <img src="${profile.imgUrl}" alt="${escapedName}"
                     onerror="this.src='https://ui-avatars.com/api/?name=${encodeURIComponent(profile.name.substring(0, 2))}&size=150&background=667eea&color=fff'">
                <div class="name">${profile.name}</div>
                ${profileLink !== '#' ? `<a class="link" href="${profileLink}" target="_blank" onclick="event.stopPropagation()">View Profile</a>` : ''}
              </div>
            `;
          });

          html += '</div>';
          container.innerHTML = html;
        }

        // Download as ZIP with images
        async function downloadAsZip(containerId, title) {
            const profiles = extractedData[containerId.replace('Results', '')];
            if (!profiles || profiles.length === 0) {
                alert('No data to download');
                return;
            }

            const zip = new JSZip();
            const imagesFolder = zip.folder("images");
            
            // Create HTML content with relative image paths
            let htmlContent = `
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>${title}</title>
    <style>
        body { font-family: Arial, sans-serif; background: #fafafa; padding: 20px; }
        h1 { text-align: center; color: #333; margin-bottom: 30px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; }
        .profile-card { background: white; border-radius: 12px; padding: 20px; text-align: center; box-shadow: 0 2px 6px rgba(0,0,0,0.1); transition: transform 0.2s; }
        .profile-card:hover { transform: translateY(-5px); }
        .profile-card img { width: 150px; height: 150px; border-radius: 50%; object-fit: cover; margin-bottom: 10px; }
        .profile-card .name { font-weight: 600; color: #333; margin-bottom: 5px; }
        .profile-card .link { color: #667eea; text-decoration: none; font-size: 0.9rem; }
        .profile-card .link:hover { text-decoration: underline; }
    </style>
</head>
<body>
    <h1>${title}</h1>
    <div class="grid">
`;

            // Add each profile with local image reference
            for (let i = 0; i < profiles.length; i++) {
                const profile = profiles[i];
                const imageFileName = `profile_${i}.jpg`;
                
                // Add image to ZIP
                if (profile.imgUrl.startsWith('data:image')) {
                    // Base64 image
                    const base64Data = profile.imgUrl.split(',')[1];
                    imagesFolder.file(imageFileName, base64Data, {base64: true});
                } else {
                    // Fallback avatar
                    try {
                        const response = await fetch(profile.imgUrl);
                        const blob = await response.blob();
                        imagesFolder.file(imageFileName, blob);
                    } catch (error) {
                        console.error('Error fetching image:', error);
                    }
                }

                htmlContent += `
        <div class="profile-card">
            <img src="images/${imageFileName}" alt="${profile.name}">
            <div class="name">${profile.name}</div>
            ${profile.profileLink !== '#' ? `<a class="link" href="${profile.profileLink}" target="_blank">View Profile</a>` : ''}
        </div>
`;
            }

            htmlContent += `
    </div>
</body>
</html>
            `;

            // Add HTML file to ZIP
            zip.file("index.html", htmlContent);

            // Generate and download ZIP
            try {
                const content = await zip.generateAsync({type: "blob"});
                const url = URL.createObjectURL(content);
                const a = document.createElement('a');
                a.href = url;
                a.download = title.toLowerCase().replace(/\s+/g, '-') + '.zip';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            } catch (error) {
                console.error('Error creating ZIP:', error);
                alert('Error creating ZIP file. Please try again.');
            }
        }

        // Extract Facebook blocked users
        async function extractFacebookBlocks() {
            const input = document.getElementById('fbBlocksInput').value;
            if (!input.trim()) {
                alert('Please paste HTML content first');
                return;
            }

            const loadingIndicator = document.getElementById('loadingIndicatorFB');
            loadingIndicator.style.display = 'inline-block';
            updateProgress('progressBarFB', 0, 'Starting...');

            try {
                extractedData.fbBlocks = await parseFacebookBlocks(input, 'progressBarFB');
                await displayProfiles(extractedData.fbBlocks, 'fbBlocksResults', 'Facebook Blocked Users');
            } catch (error) {
                console.error('Error extracting Facebook blocks:', error);
                alert('Error processing data. Please check the console for details.');
            } finally {
                loadingIndicator.style.display = 'none';
                hideProgress('progressBarFB');
            }
        }

        // Extract Instagram followers
        async function extractInstagramFollowers() {
            const input = document.getElementById('igFollowersInput').value;
            if (!input.trim()) {
                alert('Please paste HTML content first');
                return;
            }

            const loadingIndicator = document.getElementById('loadingIndicatorFollowers');
            loadingIndicator.style.display = 'inline-block';
            updateProgress('progressBarFollowers', 0, 'Starting...');

            try {
                extractedData.igFollowers = await parseInstagramProfiles(input, 'progressBarFollowers');
                await displayProfiles(extractedData.igFollowers, 'igFollowersResults', 'Instagram Followers');
            } catch (error) {
                console.error('Error extracting Instagram followers:', error);
                alert('Error processing data. Please check the console for details.');
            } finally {
                loadingIndicator.style.display = 'none';
                hideProgress('progressBarFollowers');
            }
        }

        // Extract Instagram following
        async function extractInstagramFollowing() {
            const input = document.getElementById('igFollowingInput').value;
            if (!input.trim()) {
                alert('Please paste HTML content first');
                return;
            }

            const loadingIndicator = document.getElementById('loadingIndicatorFollowing');
            loadingIndicator.style.display = 'inline-block';
            updateProgress('progressBarFollowing', 0, 'Starting...');

            try {
                extractedData.igFollowing = await parseInstagramProfiles(input, 'progressBarFollowing');
                await displayProfiles(extractedData.igFollowing, 'igFollowingResults', 'Instagram Following');
            } catch (error) {
                console.error('Error extracting Instagram following:', error);
                alert('Error processing data. Please check the console for details.');
            } finally {
                loadingIndicator.style.display = 'none';
                hideProgress('progressBarFollowing');
            }
        }

        // Find Instagram unfollowers
        async function findInstagramUnfollowers() {
            const followingInput = document.getElementById('unfollowersFollowingInput').value;
            const followersInput = document.getElementById('unfollowersFollowersInput').value;

            if (!followingInput.trim() || !followersInput.trim()) {
                alert('Please paste both Following and Followers HTML content');
                return;
            }

            const loadingIndicator = document.getElementById('loadingIndicatorUnfollowers');
            loadingIndicator.style.display = 'inline-block';
            updateProgress('progressBarUnfollowers', 30, 'Processing following...');

            try {
                const following = await parseInstagramProfiles(followingInput, 'progressBarUnfollowers');
                updateProgress('progressBarUnfollowers', 60, 'Processing followers...');
                const followers = await parseInstagramProfiles(followersInput, 'progressBarUnfollowers');

                updateProgress('progressBarUnfollowers', 90, 'Finding unfollowers...');
                const followerNames = new Set(
                    followers.map(f => f.name.toLowerCase().trim())
                );

                extractedData.igUnfollowers = following.filter(
                    person => !followerNames.has(person.name.toLowerCase().trim())
                );

                await displayProfiles(extractedData.igUnfollowers, 'igUnfollowersResults', 'Instagram Unfollowers');
                updateProgress('progressBarUnfollowers', 100, 'Complete!');
            } catch (error) {
                console.error('Error finding unfollowers:', error);
                alert('Error processing data. Please check the console for details.');
            } finally {
                loadingIndicator.style.display = 'none';
                setTimeout(() => hideProgress('progressBarUnfollowers'), 1000);
            }
        }

        // Clear results
        function clearResults(type) {
            if (type === 'ig-unfollowers') {
                document.getElementById('unfollowersFollowingInput').value = '';
                document.getElementById('unfollowersFollowersInput').value = '';
                document.getElementById('igUnfollowersResults').innerHTML = '';
                extractedData.igUnfollowers = [];
            } else if (type === 'fb-blocks') {
                document.getElementById('fbBlocksInput').value = '';
                document.getElementById('fbBlocksResults').innerHTML = '';
                extractedData.fbBlocks = [];
            } else if (type === 'ig-followers') {
                document.getElementById('igFollowersInput').value = '';
                document.getElementById('igFollowersResults').innerHTML = '';
                extractedData.igFollowers = [];
            } else if (type === 'ig-following') {
                document.getElementById('igFollowingInput').value = '';
                document.getElementById('igFollowingResults').innerHTML = '';
                extractedData.igFollowing = [];
            }
        }
    </script>
</body>
</html>