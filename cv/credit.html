<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculateur de Crédit Immobilier</title>
    <style>
        body { font-family: Arial, sans-serif; }
        label, input { display: block; margin-bottom: 8px; }
        button { margin-top: 15px; }
        #credits-container { margin-bottom: 20px; }
        #result { margin-top: 20px; white-space: pre-line; }
    </style>
    <script>
        function calculMensualite(montant, taux_annuel, duree_annees) {
            if (taux_annuel === 0) {
                return montant / (duree_annees * 12);
            }
            const taux_mensuel = taux_annuel / 12 / 100;
            const nombre_mensualites = duree_annees * 12;
            return montant * taux_mensuel / (1 - Math.pow(1 + taux_mensuel, -nombre_mensualites));
        }

        function genererChampsCredits() {
            const nbCredits = parseInt(document.getElementById('nbCredits').value) || 3;
            const container = document.getElementById('credits-container');
            container.innerHTML = '';

            for (let i = 1; i <= nbCredits; i++) {
                container.innerHTML += `
                    <h3>Crédit ${i}</h3>
                    <label>Montant (€) :</label>
                    <input type="number" id="montant${i}" required>
                    <label>Taux (%) :</label>
                    <input type="number" step="0.01" id="taux${i}" required>
                `;
            }
        }

        function calculerMensualite(event) {
            event.preventDefault();
            const nbCredits = parseInt(document.getElementById('nbCredits').value) || 3;
            const apport = parseFloat(document.getElementById('apport').value);
            const duree = parseInt(document.getElementById('duree').value);

            let mensualiteTotale = 0;
            let totalPret = 0;
            let resultText = "";

            for (let i = 1; i <= nbCredits; i++) {
                const montant = parseFloat(document.getElementById(`montant${i}`).value);
                const taux = parseFloat(document.getElementById(`taux${i}`).value);
                const mensualite = calculMensualite(montant, taux, duree);

                mensualiteTotale += mensualite;
                totalPret += montant;
                resultText += `Mensualité du crédit ${i} : ${mensualite.toFixed(2)} €\n`;

                // Spécial pour 3ème crédit → calcul 6x intérêt
                if (i === 3) {
                    const interetMensuel = montant * (taux / 100 / 12);
                    const interetMultiple = 6 * interetMensuel;
                    resultText += `6 fois l'intérêt du crédit 3 : ${interetMultiple.toFixed(2)} €\n`;
                }
            }

            const totalInvestissement = apport + totalPret;

            document.getElementById('result').innerText =
                `Mensualité totale : ${mensualiteTotale.toFixed(2)} €\n` +
                resultText +
                `Total des prêts : ${totalPret.toFixed(2)} €\n` +
                `Total de l'investissement (apport + prêts) : ${totalInvestissement.toFixed(2)} €`;
        }

        window.onload = genererChampsCredits;
    </script>
</head>
<body>
    <h1>Calculateur de Crédit Immobilier</h1>
    <form onsubmit="calculerMensualite(event)">
        <label>Nombre de crédits :</label>
        <input type="number" id="nbCredits" value="3" min="1" onchange="genererChampsCredits()">

        <div id="credits-container"></div>

        <label>Apport initial (€) :</label>
        <input type="number" id="apport" required>

        <label>Durée (années) :</label>
        <input type="number" id="duree" required>

        <button type="submit">Calculer</button>
    </form>

    <div id="result"></div>
</body>
</html>
