<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculateur de Crédit Immobilier</title>
    <link rel="stylesheet" href="styles.css">
    <script>
        function calculMensualite(montant, taux_annuel, duree_annees) {
            if (taux_annuel === 0) {
                return montant / (duree_annees * 12);
            }
            const taux_mensuel = taux_annuel / 12 / 100;
            const nombre_mensualites = duree_annees * 12;
            return montant * taux_mensuel / (1 - Math.pow(1 + taux_mensuel, -nombre_mensualites));
        }

        function updateNotaireRate() {
            const type = document.getElementById("typeImmobilier").value;
            const fraisInput = document.getElementById("fraisNotaire");
            fraisInput.value = (type === "neuf") ? 3 : 8;
        }

        function genererChampsCredits() {
            const nbCredits = parseInt(document.getElementById('nbCredits').value) || 3;
            const container = document.getElementById('credits-container');
            container.innerHTML = '';

            for (let i = 1; i <= nbCredits; i++) {
                container.innerHTML += `
                    <div class="credit-card">
                        <h3>Crédit ${i}</h3>
                        <label>Montant (€) :</label>
                        <input type="number" id="montant${i}" required>
                        <label>Taux (%) :</label>
                        <input type="number" step="0.01" id="taux${i}" required>
                    </div>
                `;
            }
        }

        function calculerMensualite(event) {
            event.preventDefault();
            const nbCredits = parseInt(document.getElementById('nbCredits').value) || 3;
            const apport = parseFloat(document.getElementById('apport').value);
            const duree = parseInt(document.getElementById('duree').value);

            const fraisNotairePct = parseFloat(document.getElementById("fraisNotaire").value);

            let mensualiteTotale = 0;
            let totalPret = 0;
            let resultText = "";

            for (let i = 1; i <= nbCredits; i++) {
                const montant = parseFloat(document.getElementById(`montant${i}`).value);
                const taux = parseFloat(document.getElementById(`taux${i}`).value);
                const mensualite = calculMensualite(montant, taux, duree);

                mensualiteTotale += mensualite;
                totalPret += montant;
                resultText += `Mensualité du crédit ${i} : ${mensualite.toFixed(2)} €\n`;

                if (i === 3) {
                    const interetMensuel = montant * (taux / 100 / 12);
                    const interetMultiple = 6 * interetMensuel;
                    resultText += `6 fois l'intérêt du crédit 3 : ${interetMultiple.toFixed(2)} €\n`;
                }
            }

            const totalInvestissement = apport + totalPret;
            const fraisNotaire = totalInvestissement * (fraisNotairePct / 100);
            const prixBrut = totalInvestissement - fraisNotaire;

            document.getElementById('result').innerText =
                `Mensualité totale : ${mensualiteTotale.toFixed(2)} €\n` +
                resultText +
                `Total des prêts : ${totalPret.toFixed(2)} €\n` +
                `Total de l'investissement (apport + prêts) : ${totalInvestissement.toFixed(2)} €\n` +
                `Frais de notaire (${fraisNotairePct}%) : ${fraisNotaire.toFixed(2)} €\n` +
                `Prix du bien (brut) : ${prixBrut.toFixed(2)} €`;
        }

        function reinitialiserFormulaire() {
            document.querySelector("form").reset();
            document.getElementById("credits-container").innerHTML = "";
            document.getElementById("result").innerText = "";
            genererChampsCredits();
            updateNotaireRate();
        }

        window.onload = genererChampsCredits;
    </script>
</head>
<body>
    <div class="container">
        <h1>Calculateur de Crédit Immobilier</h1>
        <form onsubmit="calculerMensualite(event)">
            <label>Type de bien :</label>
            <select id="typeImmobilier" onchange="updateNotaireRate()">
                <option value="neuf">Immobilier Neuf (3%)</option>
                <option value="ancien">Immobilier Ancien (8%)</option>
            </select>

            <label>Frais de notaire (%) :</label>
            <input type="number" id="fraisNotaire" value="3" step="0.1">

            <label>Nombre de crédits :</label>
            <input type="number" id="nbCredits" value="3" min="1" onchange="genererChampsCredits()">

            <div id="credits-container"></div>

            <label>Apport initial (€) :</label>
            <input type="number" id="apport" required>

            <label>Durée (années) :</label>
            <input type="number" id="duree" required>

            <div class="buttons">
                <button type="submit">Calculer</button>
                <button type="button" onclick="reinitialiserFormulaire()">Réinitialiser</button>
            </div>
        </form>

        <div id="result"></div>
    </div>
</body>
</html>
